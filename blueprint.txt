
================================================================================
TO DO LIST & ARCHITECTURAL ROADMAP
================================================================================
[HUMAN-ONLY ACCESS: AI AGENTS ARE PROHIBITED FROM MODIFYING OR EDITING THIS BOX]
[THE FOLLOWING SECTION IS RESERVED FOR THE HUMAN ARCHITECT]

CRITICAL FUTURE UPDATES:
- The end goal for this code is to be on the iOS app store for free with premium upgrade features
- [ ] Phase 1: REFACTOR - Migrate "Hybrid Architecture" to 100% React. Eliminate Vanilla templates.js.
- [ ] Phase 1: INTEGRITY - Move logic to TypeScript (FireEngine.ts) to prevent currency-to-string math errors.
- [ ] Phase 1: STATE - Replace window.currentData with React Context/Zustand for true reactivity.
- [ ] Phase 2: PERFORMANCE - Offload Burndown simulation (70+ year loops) to a Web Worker.
- [ ] Phase 2: REVENUE - Add "Educational Needs" section in Budget for automated 529 drawdown tracking.

V4.5 COMPLETED LOGIC:
- [x] SOLVER: Implemented Newton-Raphson "Smart Correction" to hit budget targets with $1 precision.
- [x] IRON FIST: Enforced strict priority depletion (no priority smearing across accounts).
- [x] PERSONAS: Simplified to "HANDOUT HUNTER" and "IRON FIST". 
- [x] UI REORGANIZATION: Swapped SNAP (now middle) and Cash Safety Net (now right) cards.
- [x] UI: Moved Real Dollars toggle to the top header for better accessibility.
- [x] LOGIC: Clicking DWZ or Preservation Age cards auto-sets relevant parameters.
- [x] UI: Handout Hunter enables SNAP Target Floor; Iron Fist greys it out and disables it.
- [x] INSOLVENCY: Defined as <$1,000 total drawable liquid assets (including HELOC credit). Removed Shortfall.

================================================================================
PROJECT OVERVIEW: FIRECALC RETIREMENT ARCHITECT
================================================================================
FIRECalc is a high-fidelity decumulation engine designed for hyper-realistic 
retirement simulation. Unlike basic "mountain chart" calculators, FIRECalc 
solves for survival, tax liability, and government benefit eligibility in real-time.

--------------------------------------------------------------------------------
CORE FEATURE MODULES
--------------------------------------------------------------------------------
1.  ASSET ARCHITECTURE: 
    Tracks liquidity (Cash, Taxable, Roth, 401k), illiquid equity (Real Estate, 
    Other Assets), and Private Equity (Stock Options/RSUs). Private equity 
    includes a dedicated growth solver and ordinary income tax treatment.

2.  INCOME STREAMS: 
    Dynamic W2/1099 modeling with automated 401k contribution caps, matching 
    logic, and bonus structures. Features a "Non-Taxable Until" field for 
    modeling foreign earned income exclusions or temporary tax holidays.

3.  BUDGET & SAVINGS: 
    Distinguishes between "Savings" (Inflows) and "Expenses" (Outflows). 
    Supports "Fixed" expenses (no inflation) and "Retirement Toggle" to 
    instantly model lifestyle changes (e.g., stopping daycare costs).

4.  BENEFIT OPTIMIZER: 
    Real-time ACA (Obamacare) and SNAP (Food Stamps) simulator. Models Medicaid 
    expansion gaps by state and recalculates household size based on child 
    birth years (aging out at 19).

--------------------------------------------------------------------------------
THE BURNDOWN ENGINE: DECUMULATION LOGIC
--------------------------------------------------------------------------------
The "Burndown" is a 15-pass iterative solver that determines the exact 
withdrawal required to satisfy the target budget while accounting for the 
"Tax Spiral" (withdrawals increase taxes, which require more withdrawals).

1.  THE WATERFALL: 
    Assets are drained according to a user-defined drag-and-drop priority list.

2.  SEPP / 72(t) LOGIC: 
    If a user retires before age 59.5, the engine calculates the maximum IRS-
    allowed penalty-free withdrawal (SEPP) based on life expectancy.

--------------------------------------------------------------------------------
ALGORITHM ARCHIVE: SMART ERROR-CORRECTION SOLVER (NEWTON-RAPHSON)
--------------------------------------------------------------------------------
Implemented in v4.5 to resolve tax calculation overshoots/undershoots.

1.  LOOP STRUCTURE:
    - Runs a 15-pass iterative cycle.
    - Tracks `smartAdjustments` map persistently across loops.

2.  ERROR MEASUREMENT:
    - At end of Loop N, calculates `surplus = RealizedPostTaxIncome - TargetBudget`.
    - Determines `observedFriction` (Tax + Aid Loss per dollar drawn).

3.  CORRECTION LOGIC (Newton-Raphson):
    - Calculates `GrossCorrection = surplus / (1 - observedFriction)`.
    - Identifies the "Marginal Asset" (the last account touched in the waterfall).
    - Applies `GrossCorrection * 0.8` (Damping Factor) to that specific asset's
      target draw for Loop N+1.

4.  STRICT PRIORITY ("IRON FIST"):
    - Enforces `adjustmentWeight = 1.0`.
    - If an account has funds but doesn't cover the full gap, it draws 100% 
      of the account and STOPS the waterfall for that loop to prevent 
      "priority smearing" (drawing small amounts from lower priority accounts 
      due to tax estimation errors).

--------------------------------------------------------------------------------
BURNDOWN STRATEGY MODES
--------------------------------------------------------------------------------
A.  HANDOUT HUNTER (Benefit Maximizer):
    - Target: Stay under 138% FPL (Federal Poverty Level).
    - Logic: Solves for a "MAGI Ceiling." It will attempt to pull as much as 
      possible from non-taxable assets (Cash, Roth) to keep taxable income 
      low enough to qualify for $0 premiums and max SNAP benefits.
    - Enables "SNAP Target Floor" slider to solve for specific aid amounts.

B.  IRON FIST (Strict Priority):
    - Target: Zero tax-optimization.
    - Logic: Follows the Draw Order waterfall blindly. It will exhaust the 
      first asset in the list entirely before moving to the second, 
      regardless of the tax consequence or benefit loss.

--------------------------------------------------------------------------------
LOGIC TRACE & STATUS DEFINITIONS
--------------------------------------------------------------------------------
The Advanced Logic Trace provides a year-by-year "under the hood" look at the 
math, showing exactly how many dollars were pulled from which account and the 
resulting tax/health premium drag.

STATUS DEFINITIONS:
- PLATINUM (Green): Medicaid/Max Subsidy (<138% FPL).
- SILVER (Blue): High CSR Subsidy (138% - 250% FPL).
- MEDICARE (Slate): Age 65+ standard status.
- INSOLVENT (Red): TOTAL LIQUID DEPLETION. All drawable accounts (Cash, 
  Brokerage, Roth, 401k, HSA, Crypto, Metals, AND available HELOC credit) 
  are effectively $0 (<$1,000 total). Real Estate equity is not 
  considered solvent for daily bills.

--------------------------------------------------------------------------------
TECHNICAL ARCHITECTURE: SYNC & DOLLARS
--------------------------------------------------------------------------------
1.  REAL vs NOMINAL: 
    Toggle between "Nominal Dollars" (face value in future years) and 
    "2026 Dollars" (purchasing power adjusted for inflation).

2.  GLOBAL SYNC: 
    Configuration keys (Current Age, Growth Rates, Inflation) are synced 
    globally via `GLOBAL_SYNC_KEYS`. Changing the market outlook in Config 
    instantly updates the Burndown and Projection models.

3.  PRECISION MATH: 
    The engine treats Real Estate appreciation and Mortgage principal paydown 
    as distinct logical flows, ensuring Net Worth reflects both debt 
    reduction and asset growth.
================================================================================
